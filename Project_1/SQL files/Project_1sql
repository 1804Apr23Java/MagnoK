-- Project 1
-- Kevin Magno

CREATE TABLE EMPLOYEE (
    EMPLOYEE_ID INTEGER PRIMARY KEY,
    EMPLOYEE_LASTNAME VARCHAR2(25) NOT NULL,
    EMPLOYEE_FIRSTNAME VARCHAR2(25) NOT NULL,
    EMPLOYEE_USERNAME VARCHAR2(25),
    EMPLOYEE_PASSWORD VARCHAR2(25)
);
/

CREATE TABLE MANAGER (
    MANAGER_ID INTEGER PRIMARY KEY,
    MANAGER_LASTNAME VARCHAR2(25) NOT NULL,
    MANAGER_FIRSTNAME VARCHAR2(25) NOT NULL,
    MANAGER_USERNAME VARCHAR2(25),
    MANAGER_PASSWORD VARCHAR2(25)
);
/

CREATE TABLE REIMBURSEMENTS (
    REIMBURSEMENTS_ID INTEGER PRIMARY KEY,
    REIMBURSEMENTS_STATUS VARCHAR2(20) NOT NULL,
    REIMBURSEMENTS_REQUESTNOTES VARCHAR2(140),
    REIMBURSEMENTS_AMOUNT NUMBER(10,2) NOT NULL,
    REIMBURSEMENTS_REQUESTDATE DATE,
    REIMBURSEMENTS_IMG VARCHAR2(150)
);
/

CREATE TABLE EMPLOYEE_REIMBURSEMENTS (
    EMPLOYEE_ID INTEGER,
    REIMBURSEMENTS_ID INTEGER,
    PRIMARY KEY (EMPLOYEE_ID, REIMBURSEMENTS_ID)
);
/

CREATE TABLE MANAGER_REIMBURSEMENTS (
    MANAGER_ID INTEGER,
    REIMBURSEMENTS_ID INTEGER,
    PRIMARY KEY (MANAGER_ID, REIMBURSEMENTS_ID)
);
/

-- FOREIGN KEY CONSTRAINS (DDL)
ALTER TABLE EMPLOYEE_REIMBURSEMENTS
ADD CONSTRAINT FK_EMP_EMPLOYEE_REIMBURSEMENTS
FOREIGN KEY (EMPLOYEE_ID) REFERENCES EMPLOYEE(EMPLOYEE_ID) ON DELETE CASCADE;
/

ALTER TABLE EMPLOYEE_REIMBURSEMENTS
ADD CONSTRAINT FK_REI_EMPLOYEE_REIMBURSEMENTS
FOREIGN KEY (REIMBURSEMENTS_ID) REFERENCES REIMBURSEMENTS(REIMBURSEMENTS_ID) ON DELETE CASCADE;
/

ALTER TABLE MANAGER_REIMBURSEMENTS
ADD CONSTRAINT FK_MAN_MANAGER_REIMBURSEMENTS
FOREIGN KEY (MANAGER_ID) REFERENCES MANAGER(MANAGER_ID) ON DELETE CASCADE;
/

ALTER TABLE MANAGER_REIMBURSEMENTS
ADD CONSTRAINT FK_REI_MANAGER_REIMBURSEMENTS
FOREIGN KEY (REIMBURSEMENTS_ID) REFERENCES REIMBURSEMENTS(REIMBURSEMENTS_ID) ON DELETE CASCADE;
/

-- TRIGGER AND SEQUENCES FOR PRIMARY KEYS
CREATE SEQUENCE SQ_EMPLOYEE_PK
START WITH 1 
INCREMENT BY 1;
/

CREATE SEQUENCE SQ_MANAGER_PK
START WITH 1 
INCREMENT BY 1;
/

CREATE SEQUENCE SQ_REIMBURSEMENTS_PK
START WITH 1 
INCREMENT BY 1;
/

CREATE OR REPLACE TRIGGER TR_INSERT_EMPLOYEE
BEFORE INSERT ON EMPLOYEE
FOR EACH ROW
BEGIN
    SELECT SQ_EMPLOYEE_PK.NEXTVAL INTO :NEW.EMPLOYEE_ID FROM DUAL;
END;
/

CREATE OR REPLACE TRIGGER TR_INSERT_MANAGER
BEFORE INSERT ON MANAGER
FOR EACH ROW
BEGIN
    SELECT SQ_MANAGER_PK.NEXTVAL INTO :NEW.MANAGER_ID FROM DUAL;
END;
/

CREATE OR REPLACE TRIGGER TR_INSERT_REIMBURSEMENTS
BEFORE INSERT ON REIMBURSEMENTS
FOR EACH ROW
BEGIN
    SELECT SQ_REIMBURSEMENTS_PK.NEXTVAL INTO :NEW.REIMBURSEMENTS_ID FROM DUAL;
END;
/





