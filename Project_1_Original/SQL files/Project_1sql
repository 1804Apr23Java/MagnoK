-- Project 1
-- Kevin Magno

CREATE TABLE EMPLOYEE (
    EMPLOYEE_ID INTEGER PRIMARY KEY,
    EMPLOYEE_LASTNAME VARCHAR2(25) NOT NULL,
    EMPLOYEE_FIRSTNAME VARCHAR2(25) NOT NULL,
    EMPLOYEE_USERNAME VARCHAR2(25),
    EMPLOYEE_PASSWORD VARCHAR2(25),
    EMPLOYEE_EMAIL VARCHAR2(60),
    EMPLOYEE_TITLE VARCHAR2(30),
    EMPLOYEE_BIRTHDAY DATE,
    EMPLOYEE_ADDRESS VARCHAR2(70),
    EMPLOYEE_CITY VARCHAR2(40),
    EMPLOYEE_STATE VARCHAR2(40),
    EMPLOYEE_ZIP VARCHAR2(10),
    EMPLOYEE_PHONE VARCHAR2(24),
    EMPLOYEE_MANAGERSTATUS NUMBER(1) DEFAULT 0
);
/

CREATE TABLE REIMBURSEMENTS (
    REIMBURSEMENTS_ID INTEGER PRIMARY KEY,
    REIMBURSEMENTS_STATUS VARCHAR2(20) NOT NULL,
    REIMBURSEMENTS_REQUESTNOTES VARCHAR2(140),
    REIMBURSEMENTS_AMOUNT NUMBER(10,2) NOT NULL,
    REIMBURSEMENTS_REQUESTDATE DATE,
    REIMBURSEMENTS_IMG VARCHAR2(150)
);
/

CREATE TABLE EMPLOYEE_REIMBURSEMENTS (
    EMPLOYEE_ID INTEGER,
    REIMBURSEMENTS_ID INTEGER,
    REIMBURSEMENTS_MANAGERID INTEGER,
    PRIMARY KEY (EMPLOYEE_ID, REIMBURSEMENTS_ID)
);
/

-- FOREIGN KEY CONSTRAINS (DDL)
ALTER TABLE EMPLOYEE_REIMBURSEMENTS
ADD CONSTRAINT FK_EMP_EMPLOYEE_REIMBURSEMENTS
FOREIGN KEY (EMPLOYEE_ID) REFERENCES EMPLOYEE(EMPLOYEE_ID) ON DELETE CASCADE;
/

ALTER TABLE EMPLOYEE_REIMBURSEMENTS
ADD CONSTRAINT FK_REI_EMPLOYEE_REIMBURSEMENTS
FOREIGN KEY (REIMBURSEMENTS_ID) REFERENCES REIMBURSEMENTS(REIMBURSEMENTS_ID) ON DELETE CASCADE;
/

-- TRIGGER AND SEQUENCES FOR PRIMARY KEYS
CREATE SEQUENCE SQ_EMPLOYEE_PK
START WITH 1 
INCREMENT BY 1;
/

CREATE SEQUENCE SQ_REIMBURSEMENTS_PK
START WITH 1 
INCREMENT BY 1;
/

CREATE OR REPLACE TRIGGER TR_INSERT_EMPLOYEE
BEFORE INSERT ON EMPLOYEE
FOR EACH ROW
BEGIN
    SELECT SQ_EMPLOYEE_PK.NEXTVAL INTO :NEW.EMPLOYEE_ID FROM DUAL;
END;
/

CREATE OR REPLACE TRIGGER TR_INSERT_REIMBURSEMENTS
BEFORE INSERT ON REIMBURSEMENTS
FOR EACH ROW
BEGIN
    SELECT SQ_REIMBURSEMENTS_PK.NEXTVAL INTO :NEW.REIMBURSEMENTS_ID FROM DUAL;
END;
/

-- Populate Lists
-- CREATING A REGULAR EMPLOYEE AND A MANAGER
INSERT INTO EMPLOYEE (EMPLOYEE_LASTNAME, EMPLOYEE_FIRSTNAME, EMPLOYEE_USERNAME, EMPLOYEE_PASSWORD)
VALUES ('kevin','magno','kmagno','password');





